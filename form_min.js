VarienForm=Class.create(),VarienForm.prototype={initialize:function(a,b){if(this.form=$(a),this.form&&(this.cache=$A(),this.currLoader=!1,this.currDataIndex=!1,this.validator=new Validation(this.form),this.elementFocus=this.elementOnFocus.bindAsEventListener(this),this.elementBlur=this.elementOnBlur.bindAsEventListener(this),this.childLoader=this.onChangeChildLoad.bindAsEventListener(this),this.highlightClass="highlight",this.extraChildParams="",this.firstFieldFocus=b||!1,this.bindElements(),this.firstFieldFocus))try{Form.Element.focus(Form.findFirstElement(this.form))}catch(a){}},submit:function(a){return this.validator&&this.validator.validate()&&this.form.submit(),!1},bindElements:function(){var a=Form.getElements(this.form);for(var b in a)a[b].id&&(Event.observe(a[b],"focus",this.elementFocus),Event.observe(a[b],"blur",this.elementBlur))},elementOnFocus:function(a){var b=Event.findElement(a,"fieldset");b&&Element.addClassName(b,this.highlightClass)},elementOnBlur:function(a){var b=Event.findElement(a,"fieldset");b&&Element.removeClassName(b,this.highlightClass)},setElementsRelation:function(a,b,c,d){(a=$(a))&&(this.cache[a.id]||(this.cache[a.id]=$A(),this.cache[a.id].child=b,this.cache[a.id].dataUrl=c,this.cache[a.id].data=$A(),this.cache[a.id].first=d||!1),Event.observe(a,"change",this.childLoader))},onChangeChildLoad:function(a){element=Event.element(a),this.elementChildLoad(element)},elementChildLoad:function(a,b){this.callback=b||!1,a.value&&(this.currLoader=a.id,this.currDataIndex=a.value,this.cache[a.id].data[a.value]?this.setDataToChild(this.cache[a.id].data[a.value]):new Ajax.Request(this.cache[this.currLoader].dataUrl,{method:"post",parameters:{parent:a.value},onComplete:this.reloadChildren.bind(this)}))},reloadChildren:function(transport){var data=eval("("+transport.responseText+")");this.cache[this.currLoader].data[this.currDataIndex]=data,this.setDataToChild(data)},setDataToChild:function(a){if(a.length){var b=$(this.cache[this.currLoader].child);if(b){var c='<select name="'+b.name+'" id="'+b.id+'" class="'+b.className+'" title="'+b.title+'" '+this.extraChildParams+">";this.cache[this.currLoader].first&&(c+='<option value="">'+this.cache[this.currLoader].first+"</option>");for(var d in a)a[d].value&&(c+='<option value="'+a[d].value+'"',!b.value||b.value!=a[d].value&&b.value!=a[d].label||(c+=" selected"),c+=">"+a[d].label+"</option>");c+="</select>",Element.insert(b,{before:c}),Element.remove(b)}}else{var b=$(this.cache[this.currLoader].child);if(b){var c='<input type="text" name="'+b.name+'" id="'+b.id+'" class="'+b.className+'" title="'+b.title+'" '+this.extraChildParams+">";Element.insert(b,{before:c}),Element.remove(b)}}this.bindElements(),this.callback&&this.callback()}},RegionUpdater=Class.create(),RegionUpdater.prototype={initialize:function(a,b,c,d,e,f){this.countryEl=$(a),this.regionTextEl=$(b),this.regionSelectEl=$(c),this.zipEl=$(f),this.config=d.config,delete d.config,this.regions=d,this.disableAction="undefined"==typeof e?"hide":e,this.zipOptions="undefined"!=typeof zipOptions&&zipOptions,this.regionSelectEl.options.length<=1&&this.update(),Event.observe(this.countryEl,"change",this.update.bind(this))},_checkRegionRequired:function(){var a,b,c=[this.regionTextEl,this.regionSelectEl],d=this;if("undefined"!=typeof this.config){var e=this.config.regions_required.indexOf(this.countryEl.value)>=0;c.each(function(c){Validation.reset(c),a=$$('label[for="'+c.id+'"]')[0],a&&(b=a.down("em")||a.down("span.required"),d.config.show_all_regions||(e?a.up().show():a.up().hide())),a&&b&&(e?e&&(b.show(),a.hasClassName("required")||a.addClassName("required")):(b.hide(),a.hasClassName("required")&&a.removeClassName("required"))),e?(c.hasClassName("required-entry")||c.addClassName("required-entry"),"select"!=c.tagName.toLowerCase()||c.hasClassName("validate-select")||c.addClassName("validate-select")):(c.hasClassName("required-entry")&&c.removeClassName("required-entry"),"select"==c.tagName.toLowerCase()&&c.hasClassName("validate-select")&&c.removeClassName("validate-select"))})}},update:function(){if(this.regions[this.countryEl.value]){var b,c,d;d=this.regionSelectEl.getAttribute("defaultValue"),this.regionTextEl&&(d||(d=this.regionTextEl.value.toLowerCase()),this.regionTextEl.value=""),this.regionSelectEl.options.length=1;for(regionId in this.regions[this.countryEl.value])c=this.regions[this.countryEl.value][regionId],b=document.createElement("OPTION"),b.value=regionId,b.text=c.name.stripTags(),b.title=c.name,this.regionSelectEl.options.add?this.regionSelectEl.options.add(b):this.regionSelectEl.appendChild(b),(regionId==d||c.name&&c.name.toLowerCase()==d||c.name&&c.code.toLowerCase()==d)&&(this.regionSelectEl.value=regionId);this.sortSelect(),"hide"==this.disableAction?(this.regionTextEl&&(this.regionTextEl.style.display="none"),this.regionSelectEl.style.display=""):"disable"==this.disableAction&&(this.regionTextEl&&(this.regionTextEl.disabled=!0),this.regionSelectEl.disabled=!1),this.setMarkDisplay(this.regionSelectEl,!0)}else this.regionSelectEl.options.length=1,this.sortSelect(),"hide"==this.disableAction?(this.regionTextEl&&(this.regionTextEl.style.display=""),this.regionSelectEl.style.display="none",Validation.reset(this.regionSelectEl)):"disable"==this.disableAction?(this.regionTextEl&&(this.regionTextEl.disabled=!1),this.regionSelectEl.disabled=!0):"nullify"==this.disableAction&&(this.regionSelectEl.options.length=1,this.regionSelectEl.value="",this.regionSelectEl.selectedIndex=0,this.lastCountryId=""),this.setMarkDisplay(this.regionSelectEl,!1);this._checkRegionRequired();var e=new ZipUpdater(this.countryEl.value,this.zipEl);e.update()},setMarkDisplay:function(a,b){a=$(a);var c=a.up(0).down("label > span.required")||a.up(1).down("label > span.required")||a.up(0).down("label.required > em")||a.up(1).down("label.required > em");c&&(inputElement=c.up().next("input"),b?(c.show(),inputElement&&inputElement.addClassName("required-entry")):(c.hide(),inputElement&&inputElement.removeClassName("required-entry")))},sortSelect:function(){for(var a=this.regionSelectEl,b=new Array,c=$(a).value,d=0;d<$(a).options.length;d++)0!=d&&(b[d-1]=new Array,b[d-1][0]=$(a).options[d].text,b[d-1][1]=$(a).options[d].value);b.sort();for(var d=1;d<=b.length;d++){var e=new Option(b[d-1][0],b[d-1][1]);$(a).options[d]=e}$(a).value=c}},ZipUpdater=Class.create(),ZipUpdater.prototype={initialize:function(a,b){this.country=a,this.zipElement=$(b)},update:function(){return"undefined"!=typeof optionalZipCountries&&void(void 0!=this.zipElement?(Validation.reset(this.zipElement),this._setPostcodeOptional()):Event.observe(window,"load",this._setPostcodeOptional.bind(this)))},_setPostcodeOptional:function(){if(this.zipElement=$(this.zipElement),void 0==this.zipElement)return!1;var a=$$('label[for="'+this.zipElement.id+'"]')[0];if(void 0!=a)var b=a.down("em")||a.down("span.required");if(optionalZipCountries.indexOf(this.country)!=-1){for(;this.zipElement.hasClassName("required-entry");)this.zipElement.removeClassName("required-entry");void 0!=b&&b.hide()}else this.zipElement.addClassName("required-entry"),void 0!=b&&b.show()}};